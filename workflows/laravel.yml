    name: Laravel CI/CD

    on:
      push:
        branches:
          - main # Trigger on pushes to the main branch
      pull_request:
        branches:
          - main # Trigger on pull requests to the main branch

    jobs:
      build-and-test:
        runs-on: ubuntu-latest # Specify the runner environment

        steps:
          - name: Checkout code
            uses: actions/checkout@v4 # Action to check out the repository code

          - name: Setup PHP
            uses: shivammathur/setup-php@v2
            with:
              php-version: '8.2' # Specify your PHP version
              extensions: mbstring, pdo_mysql, dom, fileinfo, gd, imagick, zip # Common Laravel extensions
              ini-values: post_max_size=256M, upload_max_filesize=256M

          - name: Copy .env.example to .env
            run: cp .env.example .env

          - name: Install Composer Dependencies
            run: composer install --no-ansi --no-interaction --no-progress --prefer-dist

          - name: Generate Application Key
            run: php artisan key:generate

          - name: Run Migrations
            run: php artisan migrate --force # Use --force in CI/CD to prevent prompts

          - name: Run Tests
            run: php artisan test # Or ./vendor/bin/phpunit for PHPUnit directly

      deploy:
        needs: build-and-test # This job depends on the successful completion of build-and-test
        runs-on: ubuntu-latest
        environment: production # Define an environment for deployment if needed, for secrets

        steps:
          - name: Checkout code
            uses: actions/checkout@v4

          - name: Deploy to Server
            uses: appleboy/ssh-action@master # Example action for SSH deployment
            with:
              host: ${{ secrets.SSH_HOST }}
              username: ${{ secrets.SSH_USERNAME }}
              key: ${{ secrets.SSH_PRIVATE_KEY }}
              script: |
                cd /var/www/your-laravel-app
                git pull origin main
                composer install --no-ansi --no-interaction --no-progress --prefer-dist
                php artisan migrate --force
                php artisan optimize:clear
                php artisan config:cache
                php artisan route:cache
                php artisan view:cache
                # Add any other deployment steps like restarting services